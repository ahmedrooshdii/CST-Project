<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <title>Add User - Profit Pulse</title>
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
    rel="stylesheet"/>
         <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.0/css/all.min.css" integrity="sha512-DxV+EoADOkOygM4IR9yXP8Sb2qwgidEmeqAEmDKIOfPRQZOWbXCzLC6vjbZyy0vPisbH2SyW27+ddLVCN+OMzQ==" crossorigin="anonymous" referrerpolicy="no-referrer" />

         <link rel="stylesheet" href="../../assets/css/bs/bootstrap.min.css">
    <link rel="stylesheet" href="../../assets/css/home.css">
  <link rel="stylesheet" href="css/style.css">
    <script src="../../assets/js/home.js" defer></script>

  <style>
    .modal-dialog {
    margin-top: 80px; 
}

</style>

</head>
<body class="bg-light">
    <header class="container-fluid d-md-flex justify-content-md-between">
    <div class="d-none d-md-flex gap-2">
             <a href="mailto:Mohamedbasiouny111@gmail.com"><i class="fa-solid fa-envelope"></i>Mohamedbasiouny111@gmail.com</a>
            <span>|</span>
            <a href="tel:01111514032"><i class="fa-solid fa-phone"></i></i>01111514032</a>
        </div>

        <div id="navbartop" class="d-flex flex-row-reverse justify-content-center text-uppercase gap-2 ">
            <a href="../../pages/auth/Register.html"><i class="fa-solid fa-user-plus"></i> Register</a>
            <span>|</span>
            <a href="../../pages/auth/login.html"><i class="fa-solid fa-arrow-right-to-bracket"></i> Login</a>
             <span>|</span>
            <a href="../../pages/auth/SellerRegister.html">Be a seller</a>
        </div>
  </header>
    <div class="container-fluid">
    <div class="row">
      <!-- Sidebar -->
      <div class="col-md-2 sidebar">
        <a class="navbar-brand" href="../../Home.html">
        <img
          style="width: 150px; height: 50px; margin-left: -.1vw"
          src="../../assets/images/logoLight.svg"
          alt="Logo"
        />
      </a>
      <ul>
        <li><a href="dashboard.html" class="nav-link">ðŸ“Š Dashboard</a></li>
        <li><a href="profile.html" class="nav-link">ðŸ‘¤ profile</a></li>
        <li><a id="usersPage" href="users.html" class="nav-link">ðŸ‘¤ Users</a></li>
        <li><a href="orders.html" class="nav-link">ðŸ›’ Orders</a></li>
        <li><a href="products.html" class="nav-link active">ðŸ›’ Products</a></li>
        <li><a href="customers.html" class="nav-link">ðŸ‘¥ Customers</a></li>
        <li><a href="categories.html" class="nav-link">ðŸ‘¥ Categories</a></li>
        <li><a href="contactus.html" class="nav-link">ðŸ‘¥ Contact us</a></li>
      </ul>
      </div>

    <!-- Main Content -->
<div class="content" style="max-width: calc(100vw - 250px); overflow-x: hidden;">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h2 class="fw-bold">Products</h2>
    <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addProductModal">+ Add Product</button>
  </div>

  <!-- Full-width Search Bar inside content -->
  <div class="mb-3" style="width: 100%; max-width: 100%;">
    <input type="text" id="searchInput"  class="form-control" placeholder="Search products...">
  </div>

        <!-- Products Table -->
      
<!-- Products Table -->

   <div class="table-responsive" style="width: 100%; max-width: 100%; overflow-x: auto;">
    <table class="table table-striped align-middle text-center table-sm" id="productsTable" style="width: 100%; min-width: 600px;">
    <thead class="table-dark">
      <tr>
        <th style="width: 25%;">Product Name</th>
        <th style="width: 15%;">Price</th>
        <th style="width: 15%;">No. of Stock</th>
        <th style="width: 20%;">Status</th>
        <th style="width: 25%;">Action</th>
      </tr>
    </thead>
    <tbody>
      <!-- <tr>
        <td>iphone 14 pro</td>
        <td>$25.00</td>
        <td>15</td>
        <td><span class="badge bg-success">Active</span></td>
        <td>
          <button class="btn btn-sm btn-primary me-1">
            <i class="fa-solid fa-plus"></i>
          </button>
          <button class="btn btn-sm btn-danger">
            <i class="fa-solid fa-trash"></i>
          </button>
        </td>
      </tr> -->
      <!-- <tr>
        <td>iphone xr</td>
        <td>$40.00</td>
        <td>0</td>
        <td><span class="badge bg-danger">Out of Stock</span></td>
        <td>
          <button class="btn btn-sm btn-primary me-1">
            <i class="fa-solid fa-plus"></i>
          </button>
          <button class="btn btn-sm btn-danger">
            <i class="fa-solid fa-trash"></i>
          </button>
        </td>
      </tr> -->
    </tbody>
  </table>
</div>
        
    </div>


    <div class="modal fade" id="addProductModal" tabindex="-1" aria-labelledby="addProductModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="addProductModalLabel">Add New Product</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <form id="addProductForm">
              <div class="row">
                <div class="col-md-6">
                  <div class="mb-3">
                    <label for="productName" class="form-label">Product Name <span class="text-danger">*</span></label>
                    <input type="text" class="form-control" id="productName" name="productName" required>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="mb-3">
                    <label for="productPrice" class="form-label">Price <span class="text-danger">*</span></label>
                    <div class="input-group">
                      <span class="input-group-text">$</span>
                      <input type="number" class="form-control" id="productPrice" name="productPrice" min="0" step="1" required>
                    </div>
                  </div>
                </div>
              </div>
              <div class="row">
                <div class="col-md-6">
                  <div class="mb-3">
                    <label for="productStock" class="form-label">Stock Quantity <span class="text-danger">*</span></label>
                    <input type="number" class="form-control" id="productStock" name="productStock" min="0" required>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="mb-3">
                    <label for="productStatus" class="form-label">Status</label>
                    <select class="form-select" id="productStatus" name="productStatus">
                      <option value="Active">Active</option>
                      <option value="Inactive">Inactive</option>
                      <option value="Out of Stock">Out of Stock</option>
                    </select>
                  </div>
                </div>
              </div>
              <div class="mb-3">
                <label for="productDescription" class="form-label">Product Description</label>
                <textarea class="form-control" id="productDescription" name="productDescription" rows="3" placeholder="Enter product description..."></textarea>
              </div>
              <div class="mb-3">
                <label for="productCategory" class="form-label">Category</label>
                <select class="form-select" id="productCategory" name="productCategory">
                  <option value="">Select Category</option>
                  <option value="phones">phones</option>
                  <option value="computers">computers</option>
                  <option value="smart watch">smart watch</option>
                  <option value="camera">camera</option>
                  <option value="headphones">headphones</option>
                  <option value="gaming">gaming</option>
                </select>
              </div>
              <div class="row">
                <div class="col-12">
                  <div class="mb-3">
                    <label for="productImage" class="form-label">Product Image <span class="text-danger">*</span></label>
                    <input type="file" class="form-control" id="productImage" accept="image/*" name="productImage" required>
                  <img id="preview" src="" class="m-2 d-none"  width="100"
                  height="100" />
                  </div>
                </div>
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
            <button id="add-product-btn" type="button" class="btn btn-primary" onclick="addProduct()">Add Product</button>
          </div>
        </div>
      </div>
    </div>


    <!-- EDIT PRODUCT MODAL -->
<div class="modal fade" id="editProductModal" tabindex="-1" aria-labelledby="editProductModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg" style="margin-top:80px;">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="editProductModalLabel">Edit Product</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <form id="editProductForm">
          <input type="hidden" id="editRowIndex">
          <div class="row">

            <!-- ROSHDI ADDs -->
            <input type="hidden" id="editProductId">

            <div class="col-md-6">
              <div class="mb-3">
                <label for="editProductName" class="form-label">Product Name</label>
                <input type="text" class="form-control" id="editProductName" required>
              </div>
            </div>
            <div class="col-md-6">
              <div class="mb-3">
                <label for="editProductPrice" class="form-label">Price</label>
                <div class="input-group">
                  <span class="input-group-text">$</span>
                  <input type="number" class="form-control" id="editProductPrice" min="0" step="0.01" required>
                </div>
              </div>
            </div>
          </div>
          <div class="row">
            <div class="col-md-6">
              <div class="mb-3">
                <label for="editProductStock" class="form-label">Stock Quantity</label>
                <input type="number" class="form-control" id="editProductStock" min="0" required>
              </div>
            </div>
            <div class="col-md-6">
              <div class="mb-3">
                <label for="editProductStatus" class="form-label">Status</label>
                <select class="form-select" id="editProductStatus">
                  <option value="Active">Active</option>
                  <option value="Inactive">Inactive</option>
                  <option value="Out of Stock">Out of Stock</option>
                </select>
              </div>
            </div>
          </div>
          <div class="mb-3">
            <label for="editProductDescription" class="form-label">Product Description</label>
            <textarea class="form-control" id="editProductDescription" rows="3"></textarea>
          </div>
          <div class="row">
                <div class="col-12">
                  <div class="mb-3">
                    <label for="productImageUpdate" class="form-label">Product Image <span class="text-danger">*</span></label>
                    <input type="file" class="form-control" id="productImageUpdate" accept="image/*" name="productImageUpdate" required>
                  <img id="previewUpdate" src="" class="m-2 d-none"  width="100"
                  height="100" />
                  </div>
                </div>
              </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        <button type="button" class="btn btn-primary" onclick="saveProductChanges()">Save Changes</button>
      </div>
    </div>
  </div>
</div>

<!-- toast code -->
       <div class="position-fixed bottom-0 end-0 p-3" style="z-index: 12221">
  <div id="toastMessage" class="toast align-items-center text-bg-danger border-0" role="alert">
    <div class="d-flex">
      <div class="toast-body">
       
      </div>
      <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
    </div>
  </div>
</div>

  <script src="/assets/js/localStorageProductCRUD.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
     <script>
    let imageUrl;

document.addEventListener('DOMContentLoaded', function() {
    const searchInput = document.getElementById('searchInput');
    // talaat start
     const imageInput = document.getElementById('productImage');
    const preview = document.getElementById('preview');
     const imageInputU = document.getElementById('productImageUpdate');
    const previewU = document.getElementById('previewUpdate');
  // talaat end


    if (searchInput) {
        searchInput.addEventListener('keyup', function() {
            const searchTerm = this.value.toLowerCase();
            const table = document.getElementById('productsTable');
            const tbody = table.getElementsByTagName('tbody')[0];
            
            if (tbody) {
                const rows = tbody.getElementsByTagName('tr');
                
                for (let i = 0; i < rows.length; i++) {
                    const row = rows[i];
                    const cells = row.getElementsByTagName('td');
                    let found = false;
                    
                    for (let j = 0; j < cells.length - 1; j++) { 
                        const cellText = cells[j].textContent.toLowerCase();
                        if (cellText.includes(searchTerm)) {
                            found = true;
                            break;
                        }
                    }
                    
                    if (found || searchTerm === '') {
                        row.style.display = '';
                    } else {
                        row.style.display = 'none';
                    }
                }
            }
        });
    }

    // talaat s
    imageInput.addEventListener('change',function(){
      const file = this.files[0]

      if(file){
        const reader =new FileReader()

      reader.onload=function (ev){
         imageUrl = ev.target.result
        preview.src = imageUrl
        preview.classList.remove('d-none')
      }
      reader.readAsDataURL(file)
    }
  })
    imageInputU.addEventListener('change',function(){
      const file = this.files[0]

      if(file){
        const reader =new FileReader()

      reader.onload=function (ev){
         imageUrl = ev.target.result
        previewU.src = imageUrl
        previewU.classList.remove('d-none')
      }
      reader.readAsDataURL(file)
    }
  })
  
    // talaat e
  });

function addProduct() {
    const form = document.getElementById('addProductForm');
    const formData = new FormData(form);
    
    // Get form values
    const productName = formData.get('productName').trim();
    const productPrice = formData.get('productPrice');
    const productStock = formData.get('productStock');
    const productStatus = formData.get('productStatus');
    
    // ROSHDI ADDs
    const productDescription = formData.get("productDescription").trim();
    const productCategory = formData.get("productCategory");
    // Simulated seller ID (in real scenario from sessione)
    const currentUser = JSON.parse(sessionStorage.getItem("currentUser"));
    const sellerEmail = currentUser?.email; // "ahmedrooshdii@gmail.com"

    // Validate required fields
    if (!productName || !productPrice || !productStock ||!imageUrl) {
        alert('Please fill in all required fields (Product Name, Price, Stock Quantity , Image)');
        return;
    }
    
    // Get table tbody
    const tbody = document.querySelector('#productsTable tbody');
    
    // Create new row
    const newRow = document.createElement('tr');
    
    // Determine status badge class
    let statusClass = 'bg-success';
    if (productStatus === 'Out of Stock' || productStock == 0) {
        statusClass = 'bg-danger';
    } else if (productStatus === 'Inactive') {
        statusClass = 'bg-warning';
    }
    
    // ROSHDI ADDs
    // Get products from localStorage or empty array
    let products = JSON.parse(localStorage.getItem("products")) || [];

    const newProduct = {
      id: Date.now(), // unique ID
      name: productName,
      price: productPrice,
      stock: productStock,
      status: productStatus,
      description: productDescription,
      category: productCategory,
      sellerEmail: sellerEmail,
      image: imageUrl, // placeholder
    };

    // Save to localStorage
    products.push(newProduct);
    localStorage.setItem("products", JSON.stringify(products));

    // Create row HTML
    newRow.setAttribute("data-id", newProduct.id);
    newRow.innerHTML = `
        <td>${productName}</td>
        <td>${parseFloat(productPrice).toFixed(2)}</td>
        <td>${productStock}</td>
        <td><span class="badge ${statusClass}">${productStatus}</span></td>
        <td>
          <button class="btn btn-sm btn-primary me-1" onclick="editProduct(this)">
            <i class="fa-solid fa-edit"></i>
          </button>
          <button class="btn btn-sm btn-danger remove-btn" onclick="deleteProduct(this)">
            <i class="fa-solid fa-trash"></i>
          </button>
        </td>
    `;
    
    // Add row to table
    tbody.appendChild(newRow);
    
    // Clear form
    form.reset();
    
    // Close modal
    const modal = bootstrap.Modal.getInstance(document.getElementById('addProductModal'));
    modal.hide();
    
    // Show success message
    alert('Product added successfully!');
}

// Function to delete product
function deleteProduct(button) {
    if (confirm('Are you sure you want to delete this product?')) {
        const row = button.closest('tr');

        //#region ROSHDI ADDs
        const productId = parseInt(row.getAttribute("data-id"), 10);

        let products = JSON.parse(localStorage.getItem("products")) || [];

        products = products.filter(product => product.id !== productId);

        localStorage.setItem("products", JSON.stringify(products));
        //#endregion

        row.remove();
        alert('Product deleted successfully!');
    }
}

// Function to edit product (placeholder)
// function editProduct(button) {
//     alert('Edit functionality will be implemented soon!');
// }

function editProduct(button) {
    const row = button.closest('tr');
    const cells = row.querySelectorAll('td'); 
    const productId = row.getAttribute('data-id'); // ROSHDI ADDs

    // Fill form with existing data
    document.getElementById('editProductId').value = productId; // ROSHDI ADDs
    document.getElementById('editProductName').value = cells[0].innerText;
    document.getElementById('editProductPrice').value = parseFloat(cells[1].innerText);
    document.getElementById('editProductStock').value = cells[2].innerText;
    document.getElementById('editProductStatus').value = cells[3].innerText.trim();
    
    // Store row index for saving later
    document.getElementById('editRowIndex').value = row.rowIndex;
    
    // Show modal
    const editModal = new bootstrap.Modal(document.getElementById('editProductModal'));
    editModal.show();
}

function saveProductChanges() {
    const index = document.getElementById('editRowIndex').value;
    const table = document.getElementById('productsTable');
    const row = table.rows[index];
    
    // ROSHDI ADDs
    const productId = document.getElementById('editProductId').value;

    const name = document.getElementById('editProductName').value.trim();
    const price = document.getElementById('editProductPrice').value;
    const stock = document.getElementById('editProductStock').value;
    const status = document.getElementById('editProductStatus').value;
    const description = document.getElementById('editProductDescription').value.trim();
    

    //#region Updating LocalStorage
    let products = JSON.parse(localStorage.getItem("products")) || [];

    products = products.map(product => {
        if (product.id == productId) {
            product.name = document.getElementById("editProductName").value.trim();
            product.price = document.getElementById("editProductPrice").value;
            product.stock = document.getElementById("editProductStock").value;
            product.status = document.getElementById("editProductStatus").value;
            product.description = document.getElementById("editProductDescription").value.trim();
            product.image=imageUrl
        }
        return product;
    });

    localStorage.setItem("products", JSON.stringify(products));
    //#endregion

    // Determine badge class
    let statusClass = 'bg-success';
    if (status === 'Out of Stock' || stock == 0) {
        statusClass = 'bg-danger';
    } else if (status === 'Inactive') {
        statusClass = 'bg-warning';
    }
    
    // Update table cells
    row.cells[0].innerText = name;
    row.cells[1].innerText = price;
    row.cells[2].innerText = stock;
    row.cells[3].innerHTML = `<span class="badge ${statusClass}">${status}</span>`;
    
    // Close modal
    const editModal = bootstrap.Modal.getInstance(document.getElementById('editProductModal'));
    editModal.hide();
    
    alert('Product updated successfully!');
}

</script>
    <script src="/assets/js/seedProducts.js"></script>

</body>
</html>
